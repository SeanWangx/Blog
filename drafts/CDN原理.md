## CDN原理

### 定义

CDN（Content Deliver Network）即内容分发网络，常用于提高资源请求速度。

### 原因

资源访问速度受很多因素影响，如物理层的距离、信道带宽等；传输层的丢包、拥塞控制等；所以除了本地缓存外，最好的就是从最近的最空闲的服务器中获取到最新的缓存资源，这样就能大大提高资源请求速度。

### 原理

假设我要请求 `www.qq.com/video.mp3` 这个资源，首先是常规的迭代查询方式的DNS解析过程：

1. 请求根域名服务器获取顶级域名服务器地址
2. 请求顶级域名服务器地址获取二级域名服务器地址
3. 请求二级域名服务器地址，返回的不再是子域名服务器地址，而是下面两个东西
    1. 一条NAME字段为 `www.qq.com` 的 **CNAME记录**（由服务提供者配置），它的VALUE字段为 `www.qq.cdn.com`;
    2. 一条NAME字段为 `www.qq.cdn.com` 的 **A记录**，它的VALUE字段为 **GSLB**（全局负载均衡系统）的IP地址
4. 请求GSLB，根据发起IP的大致位置筛选出本地最优的 **SLB**（本地负载均衡系统），返回该SLB的IP地址
5. 向SLB请求 `www.qq.com/video.mp3`，决策出最优缓存服务器IP地址，提示重定向
6. 客户端重定向(302)到目标缓存服务器节点，根据缓存资源是否存在、是否过期决定是直接返回资源，还是向源站请求更新资源，回源后再返回资源。

常规解析过程中，当请求二级域名服务器时，返回的应该是一条包含源站地址的A记录，而CDN则是由服务提供商修改配置为返回一条包含GSLB别名的CNAME记录和一条对应别名映射IP地址的A记录

这里针对于A记录和CNAME记录做一下简单说明便于理解：

+ CNAME记录：可以简单理解为 {'域名A': '域名B'} 的映射记录
+ A记录：可以简单理解为 {'域名A': 'IP地址A'}

其实就是将原本指向源站域名IP的A记录，修改为了一条指向GSLB域名的CNAME记录和一条GSLB域名对应IP地址的A记录。
