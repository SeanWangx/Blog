## https

> 2020.04.14

### https和http的区别

1. http明文、https密文
2. http使用80端口，https使用443端口
3. https需要到CA申请证书，一般都要收费
4. https有用到额外请求头，数据多，速度慢

### 对称加密

server向client发送数据，如果使用http，那么都是明文传输，不够安全，所以为了安全，server与client约定一个密钥，server用密钥将数据进行加密，然后发送给client，client拿到数据后利用约定好的密钥进行解密，获取数据。

这里约定同一个密钥的加密方式就是对称加密，需要双方都知道这个密钥。

### 非对称加密

使用对称加密时候的密钥如何在双方之间约定成了一个问题，因为可能传输密钥的过程就被窃取了，所以这里需要非对称加密（RSA），即server生成一对密钥，自己保存一个私钥，告诉client一个公钥，自己用私钥对数据进行加密返给client，client用拿到的公钥对加密数据进行解密。非对称加密的特点就是，数据经过私钥加密后，只能使用公钥解密获取，而数据经过公钥加密后，只能私钥进行解密获取。

### 组合加密

使用非对称加密虽然安全，但是加密和解密的过程相对较慢，所以这里考虑使用组合的方式，即server生成一个对称加密的密钥，通过非对称加密的方式对密钥进行加密然后发送给client，client解密获取到对称加密方式的密钥，以后双方通信的数据使用约定的密钥进行对称加密处理。

### 中间人攻击

当server向client公布自己的公钥时，中间可能会被拦截，这样client获得的公钥就是中间人的公钥，这样的话数据请求传输的加密处理又没有效果了

### CA证书

CA可以理解为公证处，它的公钥一般预置在操作系统/浏览器中。数字证书的获得过程如下：

1. 明文信息`Info`：server的公钥、有效期、域名、申请者等信息
1. 消息摘要`hash(Info)`：明文信息Info经过hash算法处理获得
2. 数字签名 `sign`：CA使用自己的私钥对消息摘要(`hash(Info)`)进行加密后获得
3. 数字证书：包含源数据和数字签名 `sign + Info`

server向client发送数字证书，client用CA的公钥对数字签名进行解密得到消息摘要A，用hash算法针对源数据进行处理获得消息摘要B，若A和B相同则安全，获得server的公钥。

### 过程

场景为客户端向服务器发起安全请求

1. client -> server: 客户端发起安全请求
2. server -> client: 服务端发送包含自身公钥的数字证书
3. client -> server: 客户端使用CA的公钥进行解密得到server的公钥，使用公钥发送自己的对称加密密钥
4. server -> client: 服务端使用自己的私钥进行解密，获得客户端的对称加密的密钥，进行数据安全传输

## http2特点

1. 二进制传输
2. 头部压缩
3. 多路复用
4. 服务器推送：在第一次返回index.html的同时，分析页面资源依赖，主动推送index.js、index.css等资源；关联push cache