## html到DOM树

### 原理

首先要明确，浏览器拿到的html文件是数据流，在这个基础上组成了字符流，而浏览器针对于html文件的字符流会进行一步编译操作，在编译结束后将普通的字符流转换为特殊的数据结构，也就是DOM树构建完成。这里的编译是基于一种分词逻辑，即对于 `<` 字符，浏览器会记录并分析，这里不仅是针对特殊字符，还会有前后文的关联，如 `<` 后面如果跟着 `/`，我就认为是标签结束，如果后面是 `!`，我就认为可能是注释 `<!-- -->`，或者CDATA节点 `<![CDATA[Hello]]>`，这里更进一步分析就是还需要后面的内容辅助判断，然后对于每一个有具体含义的分词结果压入栈中，最终在栈中得到唯一一个内容，就是根节点。

### 规则

简单了解以下分词策略：

1. 对于非 `<` 字符，认为是文本节点
2. 对于 `<` 字符，认为进入**节点状态**

在**节点状态**下，还有一些策略分析规则：

1. 后一个字符是字母，可以确定是进入了一个 `开始标签`，这里更细分是开始标签的开始，后面还会有针对于 `>` 或 `/>` 的判断：开始标签的结束
2. 后一个字符是 `/`，可以确定是进入了一个 `结束标签`
3. 后一个字符是 `!`，有可能是注释也可能是CDATA

### 实现

简单的入栈出栈逻辑，可以参考括号匹配算法 —— `[{()}]`